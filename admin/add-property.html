<?php
session_start();

// Check if session exists
if (!isset($_SESSION['username'])) {
    header("Location: ../pages/login.php");
    exit;
}

// Set session validation token
if (!isset($_SESSION['page_token'])) {
    $_SESSION['page_token'] = md5(uniqid(rand(), true));
}
?>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add Property - Real Estate Dashboard</title>

  <!-- ✅ Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="./style.css">

 

</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h4>Real Estate</h4>
      <a href="./index.php"><img src="./images/Vector1.png" alt="1">Users</a>
      <a href="./property.php"><img src="./images/Vector2.png" alt="2">All Properties</a>
      <a href="../add-property.html" class="active"><img src="./images/Vector3.png" alt="3">Add Property</a>
    </div>

    <div class="mb-4 logout">
      <!-- Inside index.php -->
      <a href="../pages/logout.php" class="btn btn-danger">Logout</a>
    </div>
  </div>


  <div class="main-contents">
    <!-- Top Navbar -->
    <div class="topbar">
      <h5 class="m-0" style="color:#2F3A4A;">Property Dashboard</h5>
    </div>

  </div>


  <script src="./script.js"></script>
  <script>
    // openJobDetail now accepts either (jobId, company) or a single job object.
            window.openJobDetail = function (jobIdOrObj, company) {
                try {
                    let data;
                    if (typeof jobIdOrObj === 'object' && jobIdOrObj !== null) {
                        data = jobIdOrObj;
                    } else {
                        const jobId = jobIdOrObj;
                        data = catalog[jobId] || {
                            id: jobId,
                            title: 'Job Details',
                            category: '—',
                            type: '—',
                            salary: '—',
                            location: '—',
                            description: 'No detailed description available.',
                            responsibilities: ['No responsibilities provided.']
                        };
                    }
                    // helper to safely set textContent
                    const setText = (id, value) => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = value !== undefined && value !== null ? value : '';
                    };
                    // strip HTML tags -> return plain text
                    const stripHtml = (html) => {
                        if (!html) return '';
                        const tmp = document.createElement('div');
                        tmp.innerHTML = String(html);
                        return tmp.textContent || tmp.innerText || '';
                    };
                    // render raw HTML (used for CKEditor content)
                    const renderHtml = (id, html) => {
                        const el = document.getElementById(id);
                        if (!el) return;
                        // NOTE: this assigns innerHTML so rich content from CKEditor is displayed.
                        el.innerHTML = html || '';
                    };
                    // Skip inline panel population — only populate main content
                    // Remove these lines to prevent duplicate rendering:
                    // setText('inlineJobTitle', ...);
                    // setText('inlineCompany', ...);
                    // etc.
                    // Populate main card and detailed sections only
                    setText('mainJobTitle', data.title || '');
                    setText('mainCompany', data.company || '');
                    setText('mainCategory', data.category || '');
                    setText('mainType', data.type || '');
                    setText('mainSalary', data.salary || '');
                    setText('mainLocation', data.location || '');
                    renderHtml('longDescription', data.description || '');
                    renderHtml('longDescriptionExtra', data.details || '');
                    const longResp = document.getElementById('longResponsibilities');
                    if (longResp) {
                        longResp.innerHTML = '';
                        const respArray = Array.isArray(data.responsibilities) ? data.responsibilities : (data.responsibilities ? [data.responsibilities] : []);
                        if (respArray.length) {
                            respArray.forEach(r => {
                                const p = document.createElement('p');
                                p.innerHTML = `<i class="fa-solid fa-check" style="color: #3BB38A;"></i> ${String(r || '')}`;
                                longResp.appendChild(p);
                            });
                        } else {
                            longResp.innerHTML = `<p><i class="fa-solid fa-check" style="color: #3BB38A;"></i> No responsibilities provided.</p>`;
                        }
                    }
                    const tagsEl = document.getElementById('tagsContainer');
                    if (tagsEl) {
                        tagsEl.innerHTML = '';
                        const tagsArray = Array.isArray(data.tags) ? data.tags : (data.tags ? String(data.tags).split(',') : []);
                        tagsArray.forEach(t => {
                            const a = document.createElement('a');
                            a.className = 'anchor';
                            a.href = '#';
                            a.textContent = stripHtml(String(t).trim());
                            tagsEl.appendChild(a);
                            tagsEl.appendChild(document.createTextNode(' '));
                        });
                    }
                    const skillsEl = document.getElementById('skillsContainer');
                    if (skillsEl) {
                        const skills = Array.isArray(data.skills) ? data.skills : (data.skills ? String(data.skills).split(',') : []);
                        skillsEl.textContent = skills.length ? skills.map(s => stripHtml(s.trim())).join(', ') : '';
                    }
                    const benefitsEl = document.getElementById('benefitsContainer');
                    if (benefitsEl) {
                        const benefits = Array.isArray(data.benefits) ? data.benefits : (data.benefits ? String(data.benefits).split(',') : []);
                        benefitsEl.innerHTML = benefits.length ? benefits.map(b => `<p>${String(b || '')}</p>`).join('') : '<p style="margin:0;">Standard benefits will be shown here if provided.</p>';
                    }
                    const logoEl = document.getElementById('companyLogo');
                    if (logoEl && data.logo) {
                        logoEl.src = data.logo;
                        logoEl.alt = data.company ? `${data.company} logo` : 'Company logo';
                    }
                    if (document.getElementById('postedDate') && (data.posted_date || data.posted)) {
                        setText('postedDate', data.posted_date || data.posted);
                    }
                    const setIfText = (id, value) => { const el = document.getElementById(id); if (el) el.textContent = value || ''; };
                    setIfText('sidebarContactEmail', stripHtml(data.contact_email || data.email || ''));
                    setIfText('sidebarContactPhone', stripHtml(data.contact_phone || data.phone || ''));
                    setIfText('sidebarJobTitle', stripHtml(data.title || ''));
                    setIfText('sidebarJobType', stripHtml(data.type || ''));
                    setIfText('sidebarCategory', stripHtml(data.category || ''));
                    setIfText('sidebarExperience', stripHtml(data.experience || ''));
                    setIfText('sidebarDegree', stripHtml(data.degree || ''));
                    setIfText('sidebarSalary', stripHtml(data.salary || ''));
                    setIfText('sidebarLocation', stripHtml(data.location || ''));
                    const jobIdInput = document.querySelector('#applyForm [name="job_id"]');
                    const resolvedJobId = (typeof jobIdOrObj === 'object' ? (jobIdOrObj.id || '') : (jobIdOrObj || ''));
                    if (jobIdInput) jobIdInput.value = resolvedJobId;
                    if (data.title) document.title = `${data.title} — Jobs`;
                } catch (err) {
                    console.error('openJobDetail error:', err);
                }
            };

  </script>
</body>

</html>